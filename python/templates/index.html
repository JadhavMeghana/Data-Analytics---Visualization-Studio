{% extends "base.html" %}

{% block title %}Dashboard - Enterprise Sales Analytics{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="mb-4"><i class="fas fa-tachometer-alt"></i> Analytics Dashboard</h1>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="stat-card">
            <h3>{{ summary_stats.total_charts }}</h3>
            <p><i class="fas fa-chart-pie"></i> Charts Generated</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <h3>{{ summary_stats.interactive_dashboards }}</h3>
            <p><i class="fas fa-chart-line"></i> Interactive Dashboards</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <h3>{{ summary_stats.reports }}</h3>
            <p><i class="fas fa-file-alt"></i> Reports Available</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
            <h3>{{ summary_stats.insights }}</h3>
            <p><i class="fas fa-lightbulb"></i> Insights Generated</p>
        </div>
    </div>
</div>

<div class="row">
    <!-- Latest Report -->
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-file-alt"></i> Latest Report</h5>
            </div>
            <div class="card-body">
                <pre style="white-space: pre-wrap; font-family: 'Courier New', monospace; background: #f8f9fa; padding: 15px; border-radius: 5px;">{{ latest_report }}</pre>
            </div>
        </div>

        <!-- KPI Summary Table -->
        {% if kpi_data %}
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Recent KPI Results</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>KPI Name</th>
                                <th>Value</th>
                                <th>Date</th>
                                <th>Region</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for kpi in kpi_data %}
                            <tr>
                                <td><span class="badge bg-primary">{{ kpi.KPI_NAME }}</span></td>
                                <td><strong>${{ "{:,.2f}".format(kpi.KPI_VALUE) if kpi.KPI_VALUE else 'N/A' }}</strong></td>
                                <td>{{ kpi.KPI_DATE }}</td>
                                <td>{{ kpi.REGION_ID if kpi.REGION_ID else 'Global' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Quick Actions & Recent Files -->
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <a href="/run_demo" class="btn btn-primary w-100 mb-2" onclick="runDemo(event)">
                    <i class="fas fa-play"></i> Run Demo Mode
                </a>
                <a href="/upload" class="btn btn-success w-100 mb-2">
                    <i class="fas fa-upload"></i> Upload CSV File
                </a>
                <a href="/dashboard" class="btn btn-warning w-100 mb-2">
                    <i class="fas fa-chart-bar"></i> View Dashboard
                </a>
                <a href="/charts" class="btn btn-secondary w-100">
                    <i class="fas fa-images"></i> Browse Charts
                </a>
            </div>
        </div>

        <!-- Recent Charts -->
        {% if charts %}
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-images"></i> Recent Charts</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {% for chart in charts %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="/view_chart/{{ chart }}" class="text-decoration-none">
                            <i class="fas fa-file-image"></i> {{ chart }}
                        </a>
                        <a href="/view_chart/{{ chart }}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function runDemo(event) {
    event.preventDefault();
    if (confirm('This will run the demo mode and generate new reports. Continue?')) {
        fetch('/run_demo')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Demo mode executed successfully! Page will refresh.');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error running demo: ' + error);
            });
    }
}
</script>
{% endblock %}

